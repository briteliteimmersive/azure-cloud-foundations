{
    "name": "Deploy-Diagnostics-LogAnalytics",
    "type": "Microsoft.Authorization/policySetDefinitions",
    "apiVersion": "2021-06-01",
    "scope": null,
    "properties": {
      "policyType": "Custom",
      "displayName": "Deploy Diagnostic Settings to Azure Services",
      "description": "This policy set deploys the configurations of application Azure resources to forward diagnostic logs and metrics to an Azure Log Analytics workspace. See the list of policies of the services that are included ",
      "metadata": {
        "version": "1.0.0",
        "category": "Monitoring"
      },
      "parameters": {
        "az-062-enforce-azure-monitoring-diagnostics-agent-on-vm": {
          "metadata": {
            "description": "Audits Virtual Machine Scale Sets for the Azure Diagnostics Agentenforce-azure-monitoring-diagnostics-agent-on-vmss",
            "displayName": "az-062-enforce-azure-monitoring-diagnostics-agent-on-vm"
          },
          "type": "String",
          "allowedValues": [
            "Deny",
            "Disabled"
          ],
          "defaultValue": "Audit"
        },
        "az-063-enforce-azure-monitoring-diagnostics-agent-on-vmss": {
          "type": "String",
          "allowedValues": [
            "Deny",
            "Disabled"
          ],
          "defaultValue": "Deny",
          "metadata": {
            "displayName": "az-063-enforce-azure-monitoring-diagnostics-agent-on-vmss",
            "description": "The diagnostic settings profile name"
          }
        }
      },
      "policyDefinitions": [
        {
          "policyDefinitionReferenceId": "az-062-enforce-azure-monitoring-diagnostics-agent-on-vm",
          "policyDefinitionId": "${root_scope_resource_id}/providers/Microsoft.Authorization/policyDefinitions/az-062-enforce-azure-monitoring-diagnostics-agent-on-vm",
          "parameters": {
            "effect": {
              "value": "[parameters('az-062-enforce-azure-monitoring-diagnostics-agent-on-vm')]"
            }
          },
          "groupNames": []
        },
        {
          "policyDefinitionReferenceId": "az-063-enforce-azure-monitoring-diagnostics-agent-on-vmss",
          "policyDefinitionId": "${root_scope_resource_id}/providers/Microsoft.Authorization/policyDefinitions/az-063-enforce-azure-monitoring-diagnostics-agent-on-vmss",
          "parameters": {
            "effect": {
              "value": "[parameters('az-063-enforce-azure-monitoring-diagnostics-agent-on-vmss')]"
            }
          },
          "groupNames": []
        }
      ],
      "policyDefinitionGroups": null
    }
  }